class Charter{constructor(t,e){this.slug=t,this.active_filters={taxonomies:[],keyword:"",order:"ASC"};this.settings=Object.assign({},{filter_type:"ALM",inputs:[],clear_button:{class:""},label_container:{class:"",clickable:!1,taxonomies:!0,keyword:!1,order:!1},submit_button:{class:"",submit_only:!1},callback:null},e),this.filter_active=!1,this.alm_is_animating=!1,this.charter_init()}charter_ajaxloadmore(t){if(this.alm_is_animating)return!1;this.alm_is_animating=!0;let e={};e.taxonomy=t.taxonomies,e["taxonomy-terms"]=t.terms,e["taxonomy-operator"]=t.operator,e.s=t.keyword,e.posts_per_page="20",e.order=t.order_by,e.orderby="title",ajaxloadmore.filter("fade","300",e)}charter_clear_active_filters(){let t=this.active_filters.taxonomies;for(let e=0;e<t.length;e++)t[e].terms=[];if(this.active_filters.keyword="",this.active_filters.order="ASC",""!==this.settings.clear_button.class){document.querySelector(this.settings.clear_button.class).classList.remove("active")}}charter_update_active_filters(t,e,s,r=!1){let i=this.active_filters.taxonomies.find((e=>e.taxonomy===t)),a=i.terms.findIndex((t=>t.term_slug===e)),l={term_slug:e,term_name:s};r?i.terms=[l]:-1===a?i.terms.push(l):i.terms.splice(a,1)}charter_get_active_filters_formatted(){let t=[],e=[],s=[],r="",i="",a="",l=this.active_filters.taxonomies;for(let r=0;r<l.length;r++){let i=l[r];if(i.terms.length>0){t.push(i.taxonomy);let r=i.terms.map((t=>t.term_slug)).join(",");e.push(r),s.push("IN")}}return r=t.join(":"),i=e.join(":"),a=s.join(":"),{taxonomies:r,terms:i,operator:a}}charter_update_labels(t){let e=this.active_filters.taxonomies,s=this.active_filters.keyword,r=this.active_filters.order,i=[];if(null!==t){if(e.length>0&&this.settings.label_container.taxonomies)for(let t=0;t<e.length;t++){let s=e[t].terms;for(let t=0;t<s.length;t++){let e=s[t];i.push({slug:e.term_slug,name:e.term_name})}}""!==s&&this.settings.label_container.keyword&&i.push({slug:s,name:s}),"ASC"!==r&&this.settings.label_container.order&&i.push({slug:r,name:r}),t.innerHTML="";for(let e=0;e<i.length;e++){let s=document.createElement("span");s.classList.add("label"),s.classList.add("charter-label"),s.setAttribute("data-term",i[e].slug),s.innerHTML=i[e].name,this.settings.label_container.clickable&&(s.style.cursor="pointer",s.setAttribute("tabindex","0"),s.addEventListener("click",(t=>{let e=t.target.getAttribute("data-term"),s=this.active_filters.taxonomies.find((t=>-1!==t.terms.findIndex((t=>t.term_slug===e)))),r=s.terms.find((t=>t.term_slug===e));this.charter_update_active_filters(s.taxonomy,r.term_slug,r.term_name,!1),this.charter_filter()}))),t.appendChild(s)}}}charter_update_ui(){let t=this.settings.inputs,e=this.active_filters.taxonomies,s=this.active_filters.keyword;this.active_filters.order;for(let r=0;r<t.length;r++){let i=t[r],a=Object.keys(i)[0];if("checkbox"===a||"radio"===a){let t=i[a].taxonomy,s=i[a].input.value,r=(document.querySelector('label[for="'+i[a].input.id+'"]').innerText,e.findIndex((e=>e.taxonomy===t)));void 0!==e[r].terms.find((t=>t.term_slug===s))?(i[a].input.classList.add("active"),i[a].input.checked=!0):i[a].input.checked=!1}else if("text"===a)i[a].input.value=s;else if("select"===a){let t=i[a].taxonomy,s=i[a].input.value,r=e.findIndex((e=>e.taxonomy===t)),l=e[r].terms.find((t=>t.term_slug===s));i[a].input.selectedIndex=void 0!==l?r:0}}if(""!==this.settings.clear_button.class){let t=document.querySelector(this.settings.clear_button.class);this.filter_active?t.classList.add("active"):t.classList.remove("active")}if(""!==this.settings.label_container.class){let t=document.querySelector(this.settings.label_container.class);this.charter_update_labels(t)}}charter_filter(){if("ALM"===this.settings.filter_type){let t=this.charter_get_active_filters_formatted(),e={taxonomies:null!==t.taxonomies?t.taxonomies:"",terms:null!==t.terms?t.terms:"",operator:null!==t.operator?t.operator:"",keyword:this.active_filters.keyword,order:this.active_filters.order};this.charter_ajaxloadmore(e),""!==e.taxonomies||""!==e.keyword||"ASC"!==e.order?this.filter_active=!0:""===e.taxonomies&&""===e.keyword&&"ASC"===e.order&&(this.filter_active=!1),this.charter_update_ui(),null!==this.settings.callback&&this.settings.callback()}else"JS"===this.settings.filter_type||console.error("DG Charter Error: No valid filter_type found. Please use ALM or JS.")}charter_inputs(){let t=!0,e=this.settings.inputs,s=document.querySelectorAll('[data-charter="'+this.slug+'"]');if(null!==s&&s.length>0)for(let r=0;r<s.length;r++){let i=s[r];if("INPUT"===i.tagName){let s=i.getAttribute("type"),r=i.value,a=s;if("checkbox"===s||"radio"===s){let r=i.getAttribute("data-taxonomy");null===r?(console.error("DG Charter Error: No data-taxonomy attribute found on "+s+" input."),t=!1):(i.classList.add("charter-input"),-1===this.active_filters.taxonomies.findIndex((t=>t.taxonomy===r))&&this.active_filters.taxonomies.push({taxonomy:r,terms:[]}),e.push({[a]:{input:i,taxonomy:r}}))}else"text"===s&&(i.classList.add("charter-input"),e.push({[a]:{input:i,keyword:r}}))}else if("SELECT"===i.tagName){i.value;let s=i.tagName.toLowerCase(),r=i.getAttribute("data-taxonomy");null===r?(console.error("DG Charter Error: No data-taxonomy attribute found on "+i.tagName+" input."),t=!1):(i.classList.add("charter-input"),-1===this.active_filters.taxonomies.findIndex((t=>t.taxonomy===r))&&this.active_filters.taxonomies.push({taxonomy:r,terms:[]}),e.push({[s]:{input:i,taxonomy:r}}))}else console.error("DG Charter Error: "+i.tagName+" is not a valid input type. Please use input, select, checkbox, or radio."),t=!1}else console.error('DG Charter Error: No inputs found. Please add [data-charter="your_slug"] attribute to your inputs.'),t=!1;if(""!==this.settings.clear_button.class){let s=document.querySelector(this.settings.clear_button.class);null===s?(console.error("DG Charter Error: No clear button found with class "+this.settings.clear_button.class+'. Make sure to include a "." before the class name.'),t=!1):(s.classList.add("charter-clear-button"),e.push({clear_button:{input:s}}))}return t}charter_events(){let t=this.settings.inputs;""!==this.settings.clear_button.class&&document.querySelector(this.settings.clear_button.class),""!==this.settings.submit_button.class&&document.querySelector(this.settings.submit_button.class);if(!this.settings.submit_button.submit_only&&null!==t&&t.length>0)for(let e=0;e<t.length;e++){let s=t[e],r=Object.keys(s)[0];"checkbox"===r||"radio"===r?s[r].input.addEventListener("change",(t=>{let e=s[r].taxonomy,i=s[r].input.value,a=document.querySelector('label[for="'+s[r].input.id+'"]').innerText;this.charter_update_active_filters(e,i,a,!1),this.charter_filter()})):"text"===r?s[r].input.addEventListener("keyup",(t=>{"Enter"===t.key&&(this.active_filters.keyword=s[r].input.value,this.charter_filter())})):"select"===r?s[r].input.addEventListener("change",(t=>{let e=s[r].taxonomy,i=s[r].input.value,a=s[r].input.options[s[r].input.selectedIndex].text;this.charter_update_active_filters(e,i,a,!0),this.charter_filter()})):"clear_button"===r&&s.clear_button.input.addEventListener("click",(t=>{this.charter_clear_active_filters(),this.charter_filter()}))}}charter_init(){this.charter_inputs()&&this.charter_events()}}