class Charter{constructor(t,e){this.slug=t,this.active_filters={taxonomies:[],keyword:"",order:"ASC"};this.settings=Object.assign({},{filter_type:"",inputs:[],clear_button:{class:""},label_container:{class:"",clickable:!1,taxonomies:!0,keyword:!1,order:!1},submit_button:{class:"",submit_only:!0},results:{container_class:"",result_class:""},callback:null},e),this.filter_active=!1,this.alm_is_animating=!1,this.charter_init()}charter_ajaxloadmore(t){if(this.alm_is_animating)return!1;this.alm_is_animating=!0;let e={};e.taxonomy=t.taxonomies,e["taxonomy-terms"]=t.terms,e["taxonomy-operator"]=t.operator,e.s=t.keyword,e.posts_per_page="20",e.order=t.order_by,e.orderby="title",ajaxloadmore.filter("fade","300",e)}charter_clear_active_filters(){let t=this.active_filters.taxonomies;for(let e=0;e<t.length;e++)t[e].terms=[];if(this.active_filters.keyword="",this.active_filters.order="ASC",""!==this.settings.clear_button.class){document.querySelector(this.settings.clear_button.class).classList.remove("active")}}charter_update_active_filters(t,e,s,r=!1){let i=this.active_filters.taxonomies.find((e=>e.taxonomy===t)),a=i.terms.findIndex((t=>t.term_slug===e)),l={term_slug:e,term_name:s};r?i.terms=[l]:-1===a?i.terms.push(l):i.terms.splice(a,1)}charter_get_active_filters_formatted(){let t=[],e=[],s=[],r="",i="",a="",l=this.active_filters.taxonomies;for(let r=0;r<l.length;r++){let i=l[r];if(i.terms.length>0){t.push(i.taxonomy);let r=i.terms.map((t=>t.term_slug)).join(",");e.push(r),s.push("IN")}}return r=t.join(":"),i=e.join(":"),a=s.join(":"),{taxonomies:r,terms:i,operator:a}}charter_update_labels(t){let e=this.active_filters.taxonomies,s=this.active_filters.keyword,r=this.active_filters.order,i=[];if(null!==t){if(e.length>0&&this.settings.label_container.taxonomies)for(let t=0;t<e.length;t++){let s=e[t].terms;for(let t=0;t<s.length;t++){let e=s[t];i.push({slug:e.term_slug,name:e.term_name})}}""!==s&&this.settings.label_container.keyword&&i.push({slug:s,name:s}),"ASC"!==r&&this.settings.label_container.order&&i.push({slug:r,name:r}),t.innerHTML="";for(let e=0;e<i.length;e++){let s=document.createElement("span");if(s.classList.add("label"),s.classList.add("charter-label"),s.setAttribute("data-term",i[e].slug),s.innerHTML=i[e].name,this.settings.label_container.clickable){s.style.cursor="pointer",s.setAttribute("tabindex","0");const t=t=>{if("keyup"===t.type&&"Enter"!==t.key)return;let e=t.target.getAttribute("data-term"),s=this.active_filters.taxonomies.find((t=>-1!==t.terms.findIndex((t=>t.term_slug===e)))),r=s.terms.find((t=>t.term_slug===e));this.charter_update_active_filters(s.taxonomy,r.term_slug,r.term_name,!1),this.charter_filter(),this.charter_update_ui()};s.addEventListener("click",t),s.addEventListener("keyup",t)}t.appendChild(s)}}}charter_update_ui(t=!0){let e=this.settings.inputs,s=this.active_filters.taxonomies,r=this.active_filters.keyword;this.active_filters.order;for(let t=0;t<e.length;t++){let i=e[t],a=Object.keys(i)[0];if("checkbox"===a||"radio"===a){let t=i[a].taxonomy,e=i[a].input.getAttribute("data-term"),r=s.findIndex((e=>e.taxonomy===t));void 0!==s[r].terms.find((t=>t.term_slug===e))?(i[a].input.classList.add("active"),i[a].input.setAttribute("aria-checked","true")):(i[a].input.classList.remove("active"),i[a].input.setAttribute("aria-checked","false"))}else if("text"===a)i[a].input.value=r;else if("select"===a){let t=i[a].taxonomy,e=i[a].input.value,r=s.findIndex((e=>e.taxonomy===t)),l=s[r].terms.find((t=>t.term_slug===e));i[a].input.selectedIndex=void 0!==l?r:0}}if(""!==this.settings.clear_button.class){let t=document.querySelector(this.settings.clear_button.class);this.filter_active?t.classList.add("active"):t.classList.remove("active")}if(""!==this.settings.label_container.class&&t){let t=document.querySelector(this.settings.label_container.class);this.charter_update_labels(t)}if(""!==this.settings.submit_button.class){let t=document.querySelector(this.settings.submit_button.class);this.filter_active?t.classList.add("active"):t.classList.remove("active")}}charter_filter(){if("ALM"===this.settings.filter_type){let t=this.charter_get_active_filters_formatted(),e={taxonomies:null!==t.taxonomies?t.taxonomies:"",terms:null!==t.terms?t.terms:"",operator:null!==t.operator?t.operator:"",keyword:this.active_filters.keyword,order:this.active_filters.order};this.charter_ajaxloadmore(e),""!==e.taxonomies||""!==e.keyword||"ASC"!==e.order?this.filter_active=!0:""===e.taxonomies&&""===e.keyword&&"ASC"===e.order&&(this.filter_active=!1),null!==this.settings.callback&&this.settings.callback()}else"JS"===this.settings.filter_type||console.error("DG Charter Error: No valid filter_type found. Please use ALM or JS.")}charter_inputs(){let t=!0,e=this.settings.inputs;const s=document.querySelectorAll('[data-charter="'+this.slug+'"]');if(null===s||0===s.length)return console.error("DG Charter Error: No filter containers found with data-charter attribute."),!1;for(let r=0;r<s.length;r++){let i=s[r].querySelectorAll("[data-input]");if(null!==i&&i.length>0)for(let s=0;s<i.length;s++){const r=i[s],a=r.getAttribute("data-input"),l=a;if("checkbox"===a||"radio"===a){const s=r.getAttribute("data-tax");null===s?(console.error("DG Charter Error: No data-tax attribute found on "+a+" input."),t=!1):(r.classList.add("charter-"+a),r.setAttribute("role",a),r.setAttribute("aria-checked","false"),r.setAttribute("tabindex","0"),-1===this.active_filters.taxonomies.findIndex((t=>t.taxonomy===s))&&this.active_filters.taxonomies.push({taxonomy:s,terms:[]}),e.push({[l]:{input:r,taxonomy:s}}))}else if("select"===a){const s=r.getAttribute("data-tax");null===s?(console.error("DG Charter Error: No data-tax attribute found on "+a+" input."),t=!1):(r.classList.add("charter-select"),-1===this.active_filters.taxonomies.findIndex((t=>t.taxonomy===s))&&this.active_filters.taxonomies.push({taxonomy:s,terms:[]}),e.push({[l]:{input:r,taxonomy:s}}))}else if("text"===a){const t=r.value;r.classList.add("charter-text"),e.push({[l]:{input:r,keyword:t}})}else console.error("DG Charter Error: "+a+" is not a valid data-input value. Please use text, select, checkbox, or radio."),t=!1}else console.error("DG Charter Error: No inputs found. Please add [data-input] attribute to your inputs."),t=!1}if(""!==this.settings.clear_button.class){let s=document.querySelector(this.settings.clear_button.class);null===s?(console.error("DG Charter Error: No clear button found with class "+this.settings.clear_button.class+'. Make sure to include a "." before the class name.'),t=!1):(s.classList.add("charter-clear-button"),e.push({clear_button:{input:s}}))}if(""!==this.settings.submit_button.class){let s=document.querySelector(this.settings.submit_button.class);null===s?(console.error("DG Charter Error: No submit button found with class "+this.settings.submit_button.class+'. Make sure to include a "." before the class name.'),t=!1):e.push({submit_button:{input:s}})}return t}charter_events(){let t=this.settings.inputs,e=this.settings.submit_button.submit_only;if(null!==t&&t.length>0)for(let s=0;s<t.length;s++){let r=t[s],i=Object.keys(r)[0];if("checkbox"===i||"radio"===i){const t=t=>{if("keyup"===t.type&&"Enter"!==t.key)return;let s=r[i].taxonomy,a=r[i].input.getAttribute("data-term"),l=r[i].input.innerText;this.charter_update_active_filters(s,a,l,"radio"===i),e||this.charter_filter(),this.charter_update_ui(!e)};r[i].input.addEventListener("click",t),r[i].input.addEventListener("keyup",t)}else"text"===i?r[i].input.addEventListener("keyup",(t=>{this.active_filters.keyword=r[i].input.value,"Enter"===t.key&&(e||this.charter_filter(),this.charter_update_ui(!e))})):"select"===i||("clear_button"===i?r.clear_button.input.addEventListener("click",(t=>{this.charter_clear_active_filters(),this.charter_filter(),this.charter_update_ui()})):"submit_button"===i&&r.submit_button.input.addEventListener("click",(t=>{this.charter_filter(),this.charter_update_ui()})))}}charter_init(){""!==this.settings.filter_type?this.charter_inputs()&&this.charter_events():console.error("DG Charter Error: No filter_type found. Please add filter_type to settings object (ALM or JS).")}}